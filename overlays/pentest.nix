# /qompassai/nur-packages/overlays/nautilus.nix
# Qompass AI Overlay
# Copyright (C) 2025 Qompass AI, All rights reserved
# ----------------------------------------------------
final: prev: {
  aircrack-ng-full = prev.aircrack-ng.override {
    enableExperimental = true;
  };
  burpsuite-enhanced =
    prev.burpsuite.override {
    };
  metasploit-framework-full = prev.metasploit-framework.override {
    withPostgreSQL = true;
  };
  nmap-full = prev.nmap.override {
    graphicalSupport = true;
    withLua = true;
  };
  setoolkit-enhanced = final.callPackage (
    {
      buildPythonApplication,
      fetchFromGitHub,
      ...
    }:
      buildPythonApplication rec {
        pname = "setoolkit";
        version = "8.0.3";
        src = fetchFromGitHub {
          owner = "trustedsec";
          repo = "social-engineer-toolkit";
          rev = version;
          sha256 = "sha256-ePbmUvnzLO0Wfuhym3bNSPV1x8rcCPqKMeWSRcbJGAo=";
        };
        meta.description = "Social Engineering Toolkit (SET)";
      }
  ) {};
  sqlmap-enhanced = prev.sqlmap.overrideAttrs (old: {
    postInstall =
      old.postInstall
      + ''
        # Add custom sqlmap configurations
        mkdir -p $out/share/sqlmap/custom
      '';
  });
  wireshark-enhanced = prev.wireshark.override {
    withGtk = true;
    withPcap = true;
    withQt = true;
  };
  kali-equivalent = final.buildEnv {
    name = "kali-equivalent-tools";
    paths = [
      final.bloodhound
      final.crackmapexec
      final.enum4linux
      final.impacket
      final.ldapsearch
      final.nbtscan
      final.onesixtyone
      final.pentesting-env
      final.responder
      final.rpcclient
      final.smbclient
      final.snmpwalk
    ];
  };
  pentesting-env = final.buildEnv {
    name = "pentesting-environment";
    paths = [
      final.aircrack-ng-full
      final.apktool
      final.armitage
      final.arp-scan
      final.autopsy
      final.awscli2
      final.azure-cli
      final.beef
      final.bettercap
      final.binwalk
      final.burpsuite-enhanced
      final.curl
      final.dex2jar
      final.dirb
      final.dirbuster
      final.dnsrecon
      final.dsniff
      final.ettercap
      final.evilginx2
      final.featherduster
      final.feroxbuster
      final.ffuf
      final.fierce
      final.foremost
      final.gdb
      final.ghidra
      final.git
      final.go
      final.gobuster
      final.google-cloud-sdk
      final.gophish
      final.hashcat
      final.hashpump
      final.hostapd
      final.hping
      final.httprobe
      final.hydra
      final.jadx
      final.john
      final.king-phisher
      final.kubectl
      final.ltrace
      final.masscan
      final.medusa
      final.metasploit-framework-full
      final.mimikatz
      final.mongodb-tools
      final.ncrack
      final.nessus
      final.netcat-gnu
      final.netdiscover
      final.netsniff-ng
      final.nikto
      final.nmap-full
      final.nodejs
      final.nuclei
      final.openvas-scanner
      final.openvpn
      final.patator
      final.perl
      final.pixiewps
      final.powersploit
      final.proxychains
      final.python3
      final.python3Packages.beautifulsoup4
      final.python3Packages.dissect-cobaltstrike
      final.python3Packages.pip
      final.python3Packages.pycrypto
      final.python3Packages.requests
      final.radare2
      final.reaver
      final.recon-ng
      final.redis
      final.ruby
      final.screen
      final.setoolkit-enhanced
      final.shodan
      final.sleuthkit
      final.sliver
      final.socat
      final.sqlmap-enhanced
      final.steghide
      final.stegsolve
      final.strace
      final.sublist3r
      final.tcpdump
      final.thc-hydra
      final.theharvester
      final.tmux
      final.tor
      final.unicornscan
      final.vim
      final.volatility3
      final.wget
      final.whatweb
      final.wifite2
      final.wireshark-enhanced
      final.wpscan
      final.zmap
    ];
    postBuild = ''
      # Create Nautiulus pentesting configuration
      mkdir -p $out/etc/qai/pentesting
      cat > $out/etc/qai/nautilus/pentesting/README.md << 'EOF'
      # Qompass AI Nautilus Pentesting Environment
      This environment provides comprehensive penetration testing tools:

      ## Network Testing
      - Nmap, Masscan, Zmap for discovery and scanning
      - Wireshark, tcpdump for network analysis
      - Ettercap, Bettercap for network attacks

      ## Web Application Testing
      - Burp Suite for web proxy and testing
      - SQLmap for SQL injection testing
      - Gobuster, Dirb for directory enumeration
      - Nikto, WPScan for web vulnerability scanning

      ## Exploitation
      - Metasploit Framework for exploitation
      - Empire, BeEF for post-exploitation

      ## Wireless Security
      - Aircrack-ng suite for wireless testing
      - Wifite2 for automated wireless attacks

      ## Password Testing
      - Hashcat, John the Ripper for password cracking
      - Hydra, Medusa for brute force attacks

      ## Forensics & Reverse Engineering
      - Volatility for memory analysis
      - Ghidra, Radare2 for reverse engineering
      - Autopsy, Sleuth Kit for digital forensics

      ## Information Gathering
      - Recon-ng for reconnaissance
      - theHarvester for email/subdomain gathering
      - Shodan for internet-wide scanning

      Perfect for security assessments and red team operations.
      EOF

      # Create quick start script
      cat > $out/bin/pentesting-menu << 'EOF'
      #!/bin/sh
      echo "ğŸ”’ Qompass AI Pentesting Environment"
      echo "====================================="
      echo "1. Network Discovery (nmap, masscan)"
      echo "2. Web Testing (burpsuite, sqlmap)"
      echo "3. Wireless (aircrack-ng, wifite2)"
      echo "4. Exploitation (metasploit)"
      echo "5. Password Attacks (hashcat, john)"
      echo "6. Forensics (volatility, autopsy)"
      echo "7. Information Gathering (recon-ng)"
      echo ""
      echo "Type tool name to launch directly"
      echo "Example: nmap, burpsuite, wireshark"
      EOF
      chmod +x $out/bin/pentesting-menu
    '';
  };
  red-team-env = final.buildEnv {
    name = "red-team-environment";
    paths = [
      final.bloodhound
      final.covenant
      final.empire
      final.ghostpack
      final.gophish
      final.metasploit-framework-full
      final.powersploit
      final.python3Packages.dissect-cobaltstrike
      final.rubeus
      final.sharphound
      final.sliver
    ];
  };
  web-security-env = final.buildEnv {
    name = "web-security-environment";
    paths = [
      final.burpsuite-enhanced
      final.commix
      final.knockpy
      final.owasp-zap
      final.sqlmap-enhanced
      final.subbrute
      final.wafw00f
      final.whatweb
      final.wfuzz
      final.xsser
    ];
  };
  wireless-security-env = final.buildEnv {
    name = "wireless-security-environment";
    paths = [
      final.aircrack-ng-full
      final.bully
      final.eaphammer
      final.hostapd
      final.hostapd-mana
      final.pixiewps
      final.reaver
      final.wifite2
      final.wpa_supplicant
    ];
  };
}
